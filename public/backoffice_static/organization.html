<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon"
    href="https://media.discordapp.net/attachments/1065176955445587988/1123534910381117491/350885243_2871046769695349_6895795451906942072_n.jpg?width=372&height=580">

  <title>Organization</title>

  <!-- CSS -->
  <!-- <link rel="stylesheet" href="./global.css"> -->
  <script src="./global_js.js"></script>

  <!-- Fontawesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
    integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Swal2 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.0.11/sweetalert2.all.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
    integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- jquery -->
  <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM="
    crossorigin="anonymous"></script>

  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>

  <!-- CSS -->
  <link rel="stylesheet" href="./global_hrm.css" />

  <!-- Global JS -->
  <script src='./global_js.js'></script>
  <script src="config.js"></script>
  <!-- This css font  -->
  <link
    href="https://fonts.googleapis.com/css2?family=Kanit:wght@100;200;300;400;500&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100&display=swap"
    rel="stylesheet">


</head>
<style>
  html,
  body {
    height: 100%;
    margin: 0;
    padding: 0;
  }

  * {
    margin: 0;
    padding: 0;
  }

  .fadeIn {
    opacity: 0;
    animation: fadeIn 0.4s ease-in both;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translate3d(0, -20%, 0);
    }

    to {
      opacity: 1;
      transform: translate3d(0, 0, 0);
    }
  }

  .fadeIn:nth-child(2) {
    animation-delay: 0.2s;
  }

  .fadeIn:nth-child(3) {
    animation-delay: 0.5s;
  }

  .fadeIn:nth-child(4) {
    animation-delay: 0.8s;
  }

  .fadeIn:nth-child(5) {
    animation-delay: 1.1s;
  }

  .fadeIn:hover {
    transform: scale(105%) !important;
    cursor: pointer;
  }

  .tapmenu-user {

    height: 5vh;
    border: unset;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    margin-right: 25px;
  }

  .tapuseractive {
    border-bottom: 3px solid #009688;
  }

  .registerinput {
    border: 1px solid #d5d5d5;
    appearance: none;
    border-radius: 5px;
    height: 27px;
    padding: 0 10px;
    color: #7a7a7a;
  }

  .registerbttn {
    padding: 10px;
    border-radius: 5px;
    color: black;
    cursor: pointer;
  }

  .step_cycle {
    width: 10%;
    display: flex;
    justify-content: center;
  }

  .cycle {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #ffffff;
    color: #bcbcc8;
    border: 2px solid #ececf1;
  }

  .active_cycle {
    background-color: #009688 !important;
    border: none !important;
    color: #fff !important;
  }

  /* checkbox */
  /* Create a custom checkbox */
  .checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 20px;
    width: 20px;
    background-color: #fff;
    border: 1px solid #d2d2da;
    border-radius: 3px;
  }

  /* On mouse-over, add a grey background color */
  .container:hover input~.checkmark {
    background-color: #ccc;
  }

  /* When the checkbox is checked, add a blue background */
  .container input:checked~.checkmark {
    background-color: orangered;
    border: 1px solid orangered;
  }

  /* Create the checkmark/indicator (hidden when not checked) */
  .checkmark:after {
    content: "";
    position: absolute;
    display: none;
  }

  /* Show the checkmark when checked */
  .container input:checked~.checkmark:after {
    display: block;
  }

  /* Style the checkmark/indicator */
  .container .checkmark:after {
    left: 6px;
    top: 2px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
  }

  /* checkbox END */

  .box_organizational {
    width: 250px;
    position: relative;
  }

  .box_organizational_1 {
    width: 250px;
    height: 85px;
    margin-left: 50px;
    position: relative;
  }

  .box_organizational_2 {
    width: 250px;
    height: 85px;
    margin-left: 100px;
    position: relative;
  }

  .box_organizational_3 {
    width: 250px;
    height: 85px;
    margin-left: 150px;
    position: relative;
  }

  .box_organizational_4 {
    width: 250px;
    height: 85px;
    margin-left: 200px;
    position: relative;
  }

  .box_organizational_5 {
    width: 250px;
    height: 85px;
    margin-left: 250px;
    position: relative;
  }

  .organizational_details {
    cursor: pointer;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border: 3px solid #009688;
  }

  .long_organizational_add {
    cursor: pointer;
    width: 250px;
    height: 50px;
    border-radius: 10px;
    border: 3px solid #009688;
    color: white;
    background-color: #009688;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .organizational_bttn {
    cursor: pointer;
    width: 30px;
    height: 30px;
    position: absolute;
    bottom: 12px;
    right: -43px;
    border-radius: 10px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .organizational_line {
    width: 30%;
    height: 37%;
    border-right: 3px solid #009688;
  }

  .organizational_down_arrow {
    margin-right: 10px;
    color: #009688;
    font-size: 1.5vw;
  }

  .organizational_plus {
    font-weight: bold;
    font-size: 20px;
  }

  .organizational_icon {
    font-weight: bold;
    font-size: 10px;
  }

  .organizational_name {
    margin-left: 10px;
  }

  .overlay-slide_R_to_L {
    visibility: hidden;
    -webkit-transform: translateX(100%);
    transform: translateX(100%);
    -webkit-transition: -webkit-transform 0.4s ease-in-out, visibility 0s 0.4s;
    transition: transform 0.4s ease-in-out, visibility 0s 0.4s;
  }

  .overlay-slide_R_to_L.open {
    visibility: visible;
    -webkit-transform: translateX(0%);
    transform: translateX(0%);
    -webkit-transition: -webkit-transform 0.4s ease-in-out;
    transition: transform 0.4s ease-in-out;
  }

  .dim {
    position: absolute;
    z-index: 2;
    background-color: #5555554f;
    width: 100%;
    height: 100%;
  }

  label:has([role=switch]) {
    zoom: var(--switch-zoom, 1);
    display: inline-flex;
    align-items: center;
    gap: 1em;
    cursor: pointer;
    user-select: none;
  }

  input[role=switch] {
    --switch-handle-size: 8px;
    --switch-bg-size: 24px;
    --switch-handle-gap: 3px;
    --switch-fg: DodgerBlue;
    --switch-bg: color-mix(in srgb, var(--switch-fg) 20%, transparent);

    appearance: none;
    -webkit-appearance: none;
    box-sizing: content-box;
    display: inline-flex;
    padding-inline: 0 var(--switch-bg-size);
    border: none;
    font-size: 0;
    margin: 0;
    height: auto;
    width: auto;
    border-radius: 100px;
    background: var(--switch-bg);
    transition: var(--switch-duration, .2s) cubic-bezier(.65, 0, .5, 1);
    ;
    user-select: none;
    outline: none;
    filter: grayscale(1);
    /* de-colorize the switch */
    cursor: pointer;
  }

  input[role=switch]:checked {
    padding-inline: var(--switch-bg-size) 0;
    filter: none;
  }

  input[role=switch]::before {
    content: '';
    padding: var(--switch-handle-size);
    margin: var(--switch-handle-gap);
    background: var(--switch-fg);
    border-radius: 50%;
    transition: inherit;
  }

  #divmenu {
    /* position: fixed;
  z-index: 1; */
  }
</style>

<body style="overflow: hidden;">
  <script>
    $.get("./menu-top.html", function (data) {
      $("#sidebar-tabtop").html(data);
    });
  </script>
  <script>
    $.get("./menu-left.html", function (data) {
      $("#sidebar-tableft").html(data);
    });
  </script>

  <div class="dim" style="display: none;"></div>
  <div style="display: flex;">

    <div id="blur_bg"
      style="width: 100%; height: 100%; position: absolute; top: 0; z-index: 2; background-color: rgb(151 151 151 / 20%); backdrop-filter: blur(3px); display: none;">
    </div>


    <div id="sidebar-tableft"></div>


    <div style="width: calc(100% - 60px);">
      <div id="sidebar-tabtop">

      </div>

      <div style="width: 100%; height: calc(100vh - 60px); display: flex;">

        <div style="width: 100%; padding: 25px; overflow: scroll;">
          <div style="font-size: 24px;">โครงสร้างองค์กร</div>

          <div style="display: block;">
            <div id="main_comapany" style="height: 60px; margin-top: 10px;">

            </div>

          </div>

        </div>

      </div>

    </div>


    <div id="modal_add" class="overlay-slide_R_to_L"
      style="color: #7e7e7e; width: 45%; background-color: #fff;position: absolute; height: 100%; right: 0;z-index: 3;">
      <div
        style="margin-bottom: 20px; border-bottom: 1px solid #c8c8c8; width: auto; padding: 20px 30px; height: 30px; display: flex; align-items: center; justify-content: space-between;">
        <span style="color: black;" id="addwhat">เพิ่มแผนก</span>
        <i onclick="closeaddmodal()" style="color: black; cursor: pointer;" class="fa-solid fa-xmark"></i>
      </div>

      <div style="padding: 0 30px; position: relative;">

        <div style="display: flex; flex-direction: column; margin-bottom: 10px;">
          <span>กรอกรหัสหน่วยงาน</span>
          <input id="regis_deparment_code" style="width: 26%;" class="registerinput" type="text"
            placeholder="กรอกรหัสหน่วยงาน">
        </div>

        <div style="display: flex; flex-direction: column; margin-bottom: 10px;">
          <span>ชื่อหน่วยงาน</span>
          <input id="regis_dpname" class="registerinput" type="text" placeholder="กรอกชื่อหน่วยงาน (TH)">
        </div>

        <div style="display: flex; flex-direction: column; margin-bottom: 10px;">
          <span>ชื่อหน่วยงาน (EN)</span>
          <input class="registerinput" type="text" placeholder="กรอกชื่อหน่วยงาน (EN)">
        </div>

        <div style="display: flex; margin-bottom: 10px;">
          <div style="display: flex; flex-direction: column; margin-right: 30px;">
            <span>Latitude</span>
            <input id="regis_lat" class="registerinput" type="text" placeholder="">
          </div>

          <div style="display: flex; flex-direction: column;">
            <span>Longtitude</span>
            <input id="regis_long" class="registerinput" type="text" placeholder="">
          </div>
        </div>

        <div style="display: flex; justify-content: space-between; margin: 20px 0; ">
          <span style="color: black;">ข้อมูลบัญชี</span>
          <input onchange="show_accountinfo()" id="business_yesorno" class="registerinput" type='checkbox'
            role='switch' />
        </div>

        <div id="div_accountinfo">
          <div style="display: flex; flex-direction: column; margin-bottom: 10px;">
            <span>ประเภทรหัสบัญชี</span>
            <select class="registerinput" id="regis_typeaccount">
              <option value="0">---กรุณาเลือก---</option>
              <option value="สำนักงาน">สำนักงาน</option>
              <option value="โรงงาน">โรงงาน</option>
            </select>
          </div>

          <div style="display: flex; margin-bottom: 10px;">
            <div style="display: flex; flex-direction: column; margin-right: 30px;">
              <span>Cost Center</span>
              <input id="regis_cost_center" class="registerinput" type="text" placeholder="กรอกรหัา Cost Center">
            </div>

            <div style="display: flex; flex-direction: column; margin-bottom: 10px;">
              <span>รหัสธุรกิจ</span>
              <input id="regis_busscode" class="registerinput" type="text" placeholder="กรอกรหัสธุรกิจ">
            </div>
          </div>
        </div>


      </div>

      <div
        style="position: absolute; bottom: 0; width: 100%; height: 70px; box-shadow: 0px -5px 18px -7px rgb(88 88 88 / 19%);">
        <div
          style="display: flex; justify-content: space-between; align-items: center;  height: 100%;  padding: 0 30px;">
          <div style="display: flex; align-items: center;">
            <span style="margin-right: 12px;">สถานะการใช้งาน</span>
            <input id="regis_status" class="registerinput" type='checkbox' role='switch' />
          </div>

          <div style="display: flex;  align-items: center;">
            <div onclick="closeaddmodal()" class="registerbttn" style="border: 1px solid #cecece; margin-right: 15px;">
              ยกเลิก
            </div>
            <div id="bttn_saveregister" class="registerbttn" style="background-color: rgb(255, 132, 0);">
              เพิ่ม
            </div>
          </div>
        </div>
      </div>



    </div>





  </div>

  </div>



</body>

<script>
  let ENDPOINT = window.API_URL;

  $(document).ready(async function () {
    render()
  })

  function render() {
    $.ajax({
      type: 'post',
      url: ENDPOINT + "mobile/my_company/admin",
      data: {
        token: localStorage.token
      },
      async: true,
      success: async (res) => {
        if (res.msg == 'good' && res.company.length > 0) {
          var html = ``
          for (let i = 0; i < res.company.length; i++) {
            var data = res.company[i]
            html += `
                  <p>กลุ่ม</p>
                    <div style="font-size: 18px; font-weight: bold; color: #009688;">บริษัท ${data.com_name}</div>

                    <div style="display: flex; margin-bottom: 20px;">
                        <div style="width: 1%; background-color: #009688;"></div>
                        <div style="width: 99%; padding-left: 10px; overflow: scroll;">
    
    
                            <div id="organizational_${data.com_id}" style="position: relative; padding-bottom: 2vh;">
                              
    
                            </div>
    
    
                        </div>
                    </div>
                `
            $('#main_comapany').html(html)
            getlowerlevel(0, 0, data.com_id)
          }

        }
      }
    })
  }


  var getlevelarray = []
  var temp = {}
  function getlowerlevel(level, under, selected_comid) {
    function drawhtml() {
      $.ajax({
        type: 'post',
        url: ENDPOINT + "mobile/Get-Sequence-departments",
        data: {
          token: localStorage.token,
          com_id: parseInt(selected_comid),
          under: parseInt(under),
          level: parseInt(level) + 1
        },
        async: true,
        success: async (res) => {
          if (res.msg == 'good' && res.data.length > 0) {
            var html = ``
            for (let i = 0; i < res.data.length; i++) {
              var data = res.data[i]
              if (!temp[data.id]) {
                temp[data.id] = {}
                temp[data.id].isOpen = false
                temp[data.id].hasopen = false
              }

              if (under == 0) {
                html += `
                    <div id="sub_organizational_${data.id}" class="under_organizational_${under}" style="margin-bottom: 20px;">
                      <div class="box_organizational">
                          <div class="organizational_details" onclick="getlowerlevel(${parseInt(level) + 1} , ${data.id} , ${selected_comid})">
                              <div class="organizational_name">${data.dpname}</div>
                          </div>  
                          <div onclick="calleditmodal('${data.id}' , '${data.dpname}' , '${data.lat}' , '${data.long}' , '${data.type_account}' , '${data.cost_center}' , '${data.business_code}' , '${data.status}')"  
                              class="organizational_bttn" style="border: 3px solid #fbc200; background-color: #fbc200;"><i class='fa-solid fa-pen organizational_icon'></i></div>
                          <div onclick="removedepartment('${data.id}')"
                              class="organizational_bttn" style="border: 3px solid #fb0000; background-color: #fb0000; right: -85px;"><i class='fa-solid fa-delete-left organizational_icon'></i></div>
                      </div>
                    </div>
                    `
                var add_html = `
                    <div class="box_organizational">
                      <div class="organizational_line"></div>
                        <div onclick="calladdmodal('department', ${selected_comid} , ${under} , ${level})" class="long_organizational_add"><i class='bx bx-plus organizational_plus'></i></div>
                    </div>
                    `
              } else {
                html += `
                    <div id="sub_organizational_${data.id}" class="under_organizational_${under}">
                      <div class="box_organizational_${level}">
                        <div class="organizational_line"></div>
                          <div class="organizational_details" onclick="getlowerlevel(${parseInt(level) + 1} , ${data.id} , ${selected_comid})">
                            <div class="organizational_name">${data.dpname}</div>
                          </div>
                          <div onclick="calleditmodal('${data.id}' , '${data.dpname}' , '${data.lat}' , '${data.long}' , '${data.type_account}' , '${data.cost_center}' , '${data.business_code}' , '${data.status}')"  
                              class="organizational_bttn" style="border: 3px solid #fbc200; background-color: #fbc200;"><i class='fa-solid fa-pen organizational_icon'></i></div>
                          <div onclick="removedepartment('${data.id}')"
                              class="organizational_bttn" style="border: 3px solid #fb0000; background-color: #fb0000; right: -85px;"><i class='fa-solid fa-delete-left organizational_icon'></i></div>
                      </div>
                    </div>
                    `
                var add_html = `
                    <div class="under_organizational_${under} box_organizational_${level}">
                      <div class="organizational_line"></div>
                        <div onclick="calladdmodal('organizational', ${selected_comid} , ${under} , ${level})" class="long_organizational_add"><i class='bx bx-plus organizational_plus'></i></div>
                    </div>
                    `
              }

            }


            if (under == 0) {
              $(`#organizational_${selected_comid}`).append(html)
              $(`#organizational_${selected_comid}`).append(add_html)
            } else {
              $(`#sub_organizational_${under}`).append(html)
              $(`#sub_organizational_${under}`).append(add_html)
            }


          } else {
            if (under == 0) {
              var add_html = `
                    <div class="box_organizational">
                      <div class="organizational_line"></div>
                        <div onclick="calladdmodal('department' , ${selected_comid} , ${under} , ${level})" class="long_organizational_add"><i class='bx bx-plus organizational_plus'></i></div>
                    </div>
                    `
              $(`#organizational_${selected_comid}`).append(add_html)
            } else {
              var add_html = `
                  <div class="under_organizational_${under} box_organizational_${level}">
                    <div class="organizational_line"></div>
                      <div onclick="calladdmodal('organizational' , ${selected_comid} , ${under} , ${level})" class="long_organizational_add"><i class='bx bx-plus organizational_plus'></i></div>
                  </div>
                  `
              $(`#sub_organizational_${under}`).append(add_html)
            }
          }
        }, error: err => {
          if (under == 0) {
            var add_html = `
                  <div class="box_organizational">
                    <div class="organizational_line"></div>
                      <div onclick="calladdmodal('department' , ${selected_comid} , ${under} , ${level}) " class="long_organizational_add"><i class='bx bx-plus organizational_plus'></i></div>
                  </div>
                  `
            $(`#organizational_${selected_comid}`).append(add_html)
          } else {
            var add_html = `
                <div  class="box_organizational_${level}">
                  <div class="organizational_line"></div>
                    <div onclick="calladdmodal('organizational' , ${selected_comid} , ${under} , ${level})" class="long_organizational_add"><i class='bx bx-plus organizational_plus'></i></div>
                </div>
                `
            $(`#sub_organizational_${under}`).append(add_html)
          }
        }
      })
    }
    if (temp[under] && temp[under].isOpen === false) {
      $(`.under_organizational_${under}`).show()
      temp[under].isOpen = true
      if (temp[under].hasopen === false) {
        temp[under].hasopen = true
        drawhtml()
      } else {
        $(`.under_organizational_${under}`).show()
      }
    } else if (temp[under] && temp[under].isOpen === true) {
      $(`.under_organizational_${under}`).hide()
      temp[under].isOpen = false
    } else {
      drawhtml()
    }
  }

  function show_accountinfo() {
    if ($('#business_yesorno').prop('checked') == false) {
      $('#div_accountinfo').hide()
    } else {
      $('#div_accountinfo').show()
    }
  }

  function calladdmodal(params, com_id, under, level) {
    $(`.dim`).show()
    $(`#modal_add`).addClass('open')
    if (params == 'department') {
      $(`#addwhat`).text('เพิ่มแผนก')
    } else {
      $(`#addwhat`).text('เพิ่มกลุ่ม')
    }
    $('#business_yesorno').prop('checked', false)
    $('#div_accountinfo').hide()

    $('#bttn_saveregister').text('เพิ่ม')
    $('#bttn_saveregister').unbind('click').click(() => {
      adddepartment(com_id, under, level)
    })

    $("#regis_status").on("change", function (event) {

    });

    $('#regis_dpname').val('')
    $('#regis_lat').val('')
    $('#regis_long').val('')
    $('#regis_status').prop('checked', false)

    $('#regis_cost_center').val('')
    $('#regis_busscode').val('')
  }

  function closeaddmodal() {
    $(`#modal_add`).removeClass('open')
    $(`.dim`).hide()
  }

  function calleditmodal(dp_id, dpname, lat, long, type_account, cost_center, business_code, status) {
    $(`.dim`).show()
    $(`#modal_add`).addClass('open')

    $(`#addwhat`).text('แก้ไขข้อมูล')
    $('#regis_dpname').val(dpname)
    $('#regis_lat').val(lat && lat != 'null' ? lat : '')
    $('#regis_long').val(long && long != 'null' ? long : '')

    if (type_account) {
      $('#regis_typeaccount').val(type_account)
      $('#business_yesorno').prop('checked', true)
      $('#div_accountinfo').show()
    } else {
      $('#business_yesorno').prop('checked', false)
      $('#div_accountinfo').hide()
    }

    if (status == 'active') {
      $('#regis_status').prop('checked', true)
    } else {
      $('#regis_status').prop('checked', false)
    }

    $('#regis_cost_center').val(cost_center && cost_center != 'null' ? cost_center : '')
    $('#regis_busscode').val(business_code && business_code != 'null' ? business_code : '')


    $('#bttn_saveregister').text('บันทึก')
    $('#bttn_saveregister').unbind('click').click(() => {
      editdepartment(dp_id)
    })

    $("#regis_status").on("change", function (event) {
      removedepartment(dp_id);
    });
  }

  function removedepartment(dp_id) {
    if ($('#regis_status').prop('checked') == false) {
      $.ajax({
        type: 'post',
        url: ENDPOINT + "mobile/department/remove",
        data: {
          token: localStorage.token,
          dp_id: dp_id
        },
        async: true,
        success: async (res) => {
          if (res.msg == 'good') {
            location.reload()
          }
        }
      })
    }

  }

  function editdepartment(dp_id) {
    console.log('editdepartment was called');
    if (!$('#regis_deparment_code').val()) {
      return false
    }
    if (!$('#regis_dpname').val()) {
      return false
    }
    if ($('#business_yesorno').prop('checked') == true && $('#regis_typeaccount').val() == 0) {
      return false
    }
    $.ajax({
      type: 'post',
      url: ENDPOINT + "mobile/department/edit",
      data: {
        token: localStorage.token,
        dp_id: dp_id,
        dpname: $('#regis_dpname').val(),
        lat: $('#regis_lat').val(),
        long: $('#regis_long').val(),
        status: $('#regis_status').prop('checked') == true ? "active" : "inactive",
        type_account: $('#regis_typeaccount').val(),
        cost_center: $('#regis_cost_center').val(),
        business_code: $('#regis_busscode').val(),
        deparment_code: $('#regis_deparment_code').val() //รหัสหน่วยงาน
      },
      async: true,
      success: async (res) => {
        if (res.msg == 'good') {
          location.reload()
        }
      }
    })
  }

  function adddepartment(com_id, under, level) {
    console.log('adddepartment was called');
    // if (!$('#regis_deparment_code').val()) {
    //   return false
    // }
    if (!$('#regis_dpname').val()) {
      return false
    }
    if ($('#business_yesorno').prop('checked') == true && $('#regis_typeaccount').val() == 0) {
      return false
    }
    $.ajax({
      type: 'post',
      url: ENDPOINT + "mobile/Add-departments",
      data: {
        token: localStorage.token,
        dpname: $('#regis_dpname').val(),
        lat: $('#regis_lat').val(),
        long: $('#regis_long').val(),
        com_id: com_id,
        status: $('#regis_status').prop('checked') == true ? "active" : "inactive",
        under: under,
        level: parseInt(level) + 1,
        type_account: $('#regis_typeaccount').val(),
        cost_center: $('#regis_cost_center').val(),
        business_code: $('#regis_busscode').val(),
        deparment_code: $('#regis_deparment_code').val() //รหัสหน่วยงาน
      },
      async: true,
      success: async (res) => {
        if (res.msg == 'good') {
          location.reload()
        }
      }
    })
  }



  //   function step_test(id){

  //     $('#step_1').css('display','none')
  //     $('#step_2').css('display','none')
  //     $('#step_3').css('display','none')
  //     $('#step_4').css('display','none')

  //     $('#cycle_nextstep1').removeClass('active_cycle')
  //     $('#cycle_nextstep2').removeClass('active_cycle')
  //     $('#cycle_nextstep3').removeClass('active_cycle')
  //     $('#cycle_nextstep4').removeClass('active_cycle')

  //     if(id == 0){
  //         $('#test0').css('display','block')
  //         $('#test1').css('display','none')
  //         $('#test2').css('display','none')
  //         $('#test3').css('display','none')
  //         $('#test4').css('display','none')
  //         $('#test5').css('display','none')

  //         $('#line0').css('display','none')
  //         $('#line1').css('display','none')
  //         $('#line2').css('display','none')
  //         $('#line3').css('display','none')
  //         $('#line4').css('display','none')
  //     }
  //     else if(id == 1){
  //         $('#test0').css('display','block')
  //         $('#test1').css('display','none')
  //         $('#test2').css('display','none')
  //         $('#test3').css('display','none')
  //         $('#test4').css('display','none')
  //         $('#test5').css('display','none')

  //         $('#line0').css('display','block')
  //         $('#line1').css('display','block')
  //         $('#line2').css('display','none')
  //         $('#line3').css('display','none')
  //         $('#line4').css('display','none')
  //     }

  //   }

  var openornot = false
  var openornot2 = false
  function step_test(id) {

    $('#test0').css('display', 'none')
    $('#test1').css('display', 'none')
    $('#test2').css('display', 'none')
    $('#test3').css('display', 'none')
    $('#test4').css('display', 'none')
    $('#test5').css('display', 'none')

    $('#line0').css('display', 'none')
    $('#line1').css('display', 'none')
    $('#line2').css('display', 'none')
    $('#line3').css('display', 'none')
    $('#line4').css('display', 'none')

    if (id == 0) {
      if (!openornot) {
        openornot = !openornot
        $('#test0').css('display', 'block')
        $('#test1').css('display', 'block')
        $('#test2').css('display', 'none')
        $('#test3').css('display', 'none')
        $('#test4').css('display', 'none')
        $('#test5').css('display', 'none')

        $('#line0').css('display', 'block')
        $('#line1').css('display', 'none')
        $('#line2').css('display', 'none')
        $('#line3').css('display', 'none')
        $('#line4').css('display', 'none')

        var openornot2 = false
        console.log('openornot2')
      }
      else {
        openornot = !openornot
        $('#test0').css('display', 'block')
        $('#test1').css('display', 'none')
        $('#test2').css('display', 'none')
        $('#test3').css('display', 'none')
        $('#test4').css('display', 'none')
        $('#test5').css('display', 'none')

        $('#line0').css('display', 'none')
        $('#line1').css('display', 'none')
        $('#line2').css('display', 'none')
        $('#line3').css('display', 'none')
        $('#line4').css('display', 'none')
      }
    }
    if (id == 1) {
      console.log(openornot2)

      if (!openornot2) {
        openornot2 = !openornot2
        $('#test0').css('display', 'block')
        $('#test1').css('display', 'block')
        $('#test2').css('display', 'block')
        $('#test3').css('display', 'none')
        $('#test4').css('display', 'none')
        $('#test5').css('display', 'none')

        $('#line0').css('display', 'block')
        $('#line1').css('display', 'block')
        $('#line2').css('display', 'none')
        $('#line3').css('display', 'none')
        $('#line4').css('display', 'none')
      }
      else {
        openornot2 = !openornot2
        $('#test0').css('display', 'block')
        $('#test1').css('display', 'block')
        $('#test2').css('display', 'none')
        $('#test3').css('display', 'none')
        $('#test4').css('display', 'none')
        $('#test5').css('display', 'none')

        $('#line0').css('display', 'block')
        $('#line1').css('display', 'none')
        $('#line2').css('display', 'none')
        $('#line3').css('display', 'none')
        $('#line4').css('display', 'none')
      }
    }

  }


</script>

</html>