<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon"
        href="https://media.discordapp.net/attachments/1065176955445587988/1123534910381117491/350885243_2871046769695349_6895795451906942072_n.jpg?width=372&height=580">

    <title>รายได้ รายหัก</title>

    <!-- CSS -->
    <link rel="stylesheet" href="./global.css">
    <script src="./global.js"></script>

    <!-- Fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
        integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Swal2 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.0.11/sweetalert2.all.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
        integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.7.0.js"
        integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>

    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>

    <!-- CSS -->
    <link rel="stylesheet" href="./global_hrm.css" />

    <!-- Global JS -->
    <script src='./global_js.js'></script>
    <script src="config.js"></script>
    <!-- This css font  -->
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:wght@100;200;300;400;500&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100&display=swap"
        rel="stylesheet">


</head>
<style>
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
    }

    * {
        margin: 0;
        padding: 0;
    }

    .in-de-container {
        margin-left: 7vw;
    }

    .tab {
        display: none;
        text-align: left;
    }

    .tab.active {
        display: block;
    }

    .tab-container {
        display: flex;
    }

    .tab-button {
        padding: 10px 20px;
        cursor: pointer;
    }

    .tab-button p {
        font-size: 18px;
        font-weight: 400;
    }

    .tab-button:hover {
        color: #009688;
        border-bottom: 2px solid #009688;
    }

    table,
    th,
    td {
        border-collapse: collapse;
        height: 45px;
    }

    th,
    td {
        padding: 5px;
        text-align: left;
    }

    thead {
        background-color: #fff;
        position: sticky;
        top: 0;
    }

    hr {
        color: gray;
    }

    .btn-add {
        width: 120px;
        height: 40px;
        background: #009688;
        border: none;
        border-radius: 10px;
        color: #fff;
        cursor: pointer;
    }

    .icon {
        display: flex;
        align-items: center;
    }

    .overlay-add-income {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
    }

    .overlay-add-income-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        position: absolute;
        right: 0;
        height: 95vh;
        width: 40%;
        overflow-y: auto;
    }

    .overlay-add-deduction {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
    }

    .overlay-add-deduction-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        position: absolute;
        right: 0;
        height: 95vh;
        width: 40%;
        overflow-y: auto;
    }

    .overlay-income {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
    }

    .overlay-income-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        position: absolute;
        right: 0;
        height: 95vh;
        width: 40%;
        overflow-y: auto;
    }

    .overlay-deduction {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
    }

    .overlay-deduction-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        position: absolute;
        right: 0;
        height: 95vh;
        width: 40%;
        overflow-y: auto;
    }

    .edit-btn {
        padding: 10px 20px;
        background-color: #009688;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .code-box {
        width: 80px;
        padding: 10px;
        border-radius: 7px;
        border: 1px solid #ECECF1;
    }

    .head-overlay {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .edit-input {
        width: 90%;
        padding: 10px;
        border-radius: 7px;
        border: 1px solid #ECECF1;
    }

    .pay-box {
        margin-top: 20px;
    }

    .pay-select {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px;
    }

    .pay-select select {
        padding: 10px;
        width: 120px;
        border: 1px solid #ECECF1;
        border-radius: 7px;
    }

    .cal-box {
        padding: 10px;
    }

    /* The switch container */
    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

    /* The slider */
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

    .slider.round:before {
        border-radius: 50%;
    }

    .check-box {
        display: flex;
        gap: 10px;
    }

    .check-box input {
        width: 20px;
    }

    .x-btn {
        font-size: 25px;
        background: none;
        border: none;
        cursor: pointer;
    }

    .save-btn {
        width: 90px;
        height: 30px;
        background: #009688;
        border: none;
        color: #fff;
        border-radius: 10px;
        cursor: pointer;
    }

    .cancel-btn {
        width: 90px;
        height: 30px;
        background: #fff;
        border: 1px solid #009688;
        color: #009688;
        border-radius: 10px;
        cursor: pointer;
    }

    .table-container {
        height: 500px;
        overflow-y: auto;
    }

    .modal-confirm-income {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content-income {
        background-color: white;
        padding: 20px;
        width: 60%;
        max-width: 600px;
        margin: 20vw auto;
        border-radius: 5px;
    }

    .modal-confirm-deduction {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content-deduction {
        background-color: white;
        padding: 20px;
        width: 60%;
        max-width: 600px;
        margin: 20vw auto;
        border-radius: 5px;
    }

    .add-confirm-deduction {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .add-content-deduction {
        background-color: white;
        padding: 20px;
        width: 60%;
        max-width: 600px;
        margin: 20vw auto;
        border-radius: 5px;
    }
</style>

<body style="overflow: hidden;">
    <script>
        $.get("./menu-top.html", function (data) {
            $("#sidebar-tabtop").html(data);
        });
    </script>
    <script>
        $.get("./menu-left.html", function (data) {
            $("#sidebar-tableft").html(data);
        });
    </script>

    <div id="sidebar-tableft"></div>
    <div style="width: calc(100% - 60px);">
        <div id="sidebar-tabtop">

        </div>
        <div>

        </div>
    </div>

    <div class="in-de-container">
        <h2>ตั้งค่ารายได้รายหัก</h2>

        <div class="tab-container">
            <div class="tab-button" onclick="showData('income')">
                <p>รายได้</p>
            </div>
            <div class="tab-button" onclick="showData('deduction')">
                <p>รายหัก</p>
            </div>
        </div>
        <hr>


        <div class="tab-content">
            <div class="tab" id="income">
                <div style="text-align: right; padding: 10px;">
                    <button class="btn-add" onclick="addIncomeOverlay();">+ เพิ่มรายได้</button>
                </div>
                <div class="table-container">
                    <table style="width: 100%;" id="incomeTable">
                        <thead>
                            <tr>
                                <th>รหัส</th>
                                <th>รายได้</th>
                                <th>ประเภท</th>
                                <th>คำนวณภาษี</th>
                                <th>นอกงวด</th>
                                <th>งวดถัดไป</th>
                                <th>ทำจ่าย</th>
                                <th>คำนวณกับ</th>
                                <th>สวัสดิการ</th>
                                <th>สถานะ</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="incomeTbody">

                        </tbody>
                    </table>
                </div>

            </div>

            <div class="tab" id="deduction">
                <div style="text-align: right; padding: 10px;">
                    <button class="btn-add" onclick="addDeductionOverlay();">+ เพิ่มรายหัก</button>
                </div>

                <div class="table-container">
                    <table style="width: 100%;" id="deductionTable">
                        <thead>
                            <tr>
                                <th>รหัส</th>
                                <th>รายหัก</th>
                                <th>คำนวณภาษี</th>
                                <th>นอกงวด</th>
                                <th>งวดถัดไป</th>
                                <th>ทำจ่าย</th>
                                <th>คำนวณกับ</th>
                                <th>สวัสดิการ</th>
                                <th>สถานะ</th>
                            </tr>
                        </thead>
                        <tbody id="deductionTBody">

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

    </div>

    <!--overlay add income-->
    <div id="overlay-add-income" class="overlay-add-income" style="display: none;">
        <div class="overlay-add-income-content">
            <div class="head-overlay">
                <h3>เพิ่มรายได้</h3>
                <button class="x-btn" id="closeButton" onclick="closedAddIncomeOverlay()">X</button>
            </div>
            <div>
                <p>รหัส</p>
                <input type="text" class="code-box" id="add-code">

                <p>ชื่อรายได้*</p>
                <input type="text" class="edit-input" id="add-income">

                <p>ประเภทเงินได้*</p>
                <input type="text" class="edit-input" id="add-type">

                <div class="pay-box">
                    <h3>เงื่อนไขการจ่าย</h3>
                    <div class="pay-select">
                        <p>รายได้นี้ทำจ่าย</p>
                        <select id="add-pay">
                            <option value="ทุกงวด">ทุกงวด</option>
                            <option value="งวดสิ้นเดือน">งวดสิ้นเดือน</option>
                        </select>
                    </div>
                </div>

                <div class="pay-box">
                    <h3>เงื่อนไขการคำนวณ</h3>

                    <div class="pay-select">
                        <p>นำไปคำนวนภาษี</p>
                        <select id="add-cal-tax">
                            <option value="ไม่คำนวณ">ไม่คำนวณ</option>
                            <option value="ทั้งปี">ทั้งปี</option>
                            <option value="ครั้งเดียว">ครั้งเดียว</option>
                        </select>
                    </div>

                    <div class="cal-box">
                        <p>นำรายได้นี้ไปคำนวณกับ</p>

                        <div class="check-box">
                            <input type="checkbox" id="add-security">
                            <p>ประกันสังคม</p>
                        </div>
                        <div class="check-box">
                            <input type="checkbox" id="add-provident">
                            <p>กองทุนสำรองเลี้ยงชีพ</p>
                        </div>
                        <div class="check-box">
                            <input type="checkbox" id="add-overtime">
                            <p>ค่าล่วงเวลา</p>
                        </div>
                        <div class="check-box">
                            <input type="checkbox" id="add-late">
                            <p>หักสายขาดงาน</p>
                        </div>
                    </div>
                </div>
                <br>
                <hr>
                <br>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <p>เปิดใช้งาน</p>
                        <label class="switch">
                            <input type="checkbox" id="add-status">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="cancel-btn" onclick="closedAddIncomeOverlay();">ยกเลิก</button>
                        <button class="save-btn" onclick="sendAddIncome();">บันทึก</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--overlay add deduction-->
    <div id="overlay-add-deduction" class="overlay-add-deduction" style="display: none;">
        <div class="overlay-add-deduction-content">
            <div class="head-overlay">
                <h3>เพิ่มรายหัก</h3>
                <button class="x-btn" id="closeButton" onclick="closedAddDeductionOverlay()">X</button>
            </div>
            <hr>
            <div>
                <p>รหัส</p>
                <input type="text" class="code-box" id="add-deduction-code">

                <p>ชื่อรายหัก*</p>
                <input type="text" class="edit-input" id="add-deduction-name">

                <div class="pay-box">
                    <h3>เงื่อนไขการจ่าย</h3>
                    <div class="pay-select">
                        <p>รายหักหนี้ทำจ่าย</p>
                        <select id="add-deduction-pay">
                            <option value="ทุกงวด">ทุกงวด</option>
                            <option value="งวดสิ้นเดือน">งวดสิ้นเดือน</option>
                        </select>
                    </div>
                </div>

               <div class="pay-box">
                    <h3>เงื่อนไขการคำนวณ</h3>
                    <div class="pay-select">
                        <p>นำไปคำนวนภาษี</p>
                        <select id="add-cal-tax-deduction">
                            <option value="ไม่คำนวณ">ไม่คำนวณ</option>
                            <option value="ทั้งปี">ทั้งปี</option>
                            <option value="ครั้งเดียว">ครั้งเดียว</option>
                        </select>
                    </div>

                    <div class="cal-box">
                        <p>นำรายได้นี้ไปคำนวณกับ</p>

                        <div class="check-box">
                            <input type="checkbox" id="add-security-deduction">
                            <p>ประกันสังคม</p>
                        </div>
                        <div class="check-box">
                            <input type="checkbox" id="add-provident-deduction">
                            <p>กองทุนสำรองเลี้ยงชีพ</p>
                        </div>
                    </div>
                    <br>
                    <hr>
                    <br>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <p>เปิดใช้งาน</p>
                            <label class="switch">
                                <input type="checkbox" id="add-status-deduction">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="cancel-btn" onclick="closedAddDeductionOverlay();">ยกเลิก</button>
                            <button class="save-btn" onclick="openConfirmDeduction();">บันทึก</button>
                        </div>
                    </div>
               </div>

            </div>
        </div>
    </div>

    <!--over edit income-->
    <div id="overlay-income" class="overlay-income" style="display: none;">
        <div class="overlay-income-content">
            <div class="head-overlay">
                <h3>แก้ไขรายได้ (เงินเดือนพนักงาน)</h3>
                <button class="x-btn" id="closeButton" onclick="closedEditIncomeOverlay()">X</button>
            </div>
            <hr>
            <div>
                <p>รหัส</p>
                <input type="text" id="code" class="code-box" disabled>

                <p>ชื่อรายได้*</p>
                <input type="text" class="edit-input" id="incomeValue">

                <p>ประเภทเงินได้*</p>
                <input type="text" class="edit-input" id="type">

                <div class="pay-box">
                    <h3>เงื่อนไขการจ่าย</h3>
                    <div class="pay-select">
                        <p>รายได้นี้ทำจ่าย</p>
                        <select id="pay">
                            <option value="ทุกงวด">ทุกงวด</option>
                            <option value="งวดสิ้นเดือน">งวดสิ้นเดือน</option>
                        </select>
                    </div>
                </div>

                <div class="pay-box">
                    <h3>เงื่อนไขการคำนวณ</h3>

                    <div class="pay-select">
                        <p>นำไปคำนวนภาษี</p>
                        <select id="calTaxValue">
                            <option value="ไม่คำนวณ">ไม่คำนวณ</option>
                            <option value="ทั้งปี">ทั้งปี</option>
                            <option value="ครั้งเดียว">ครั้งเดียว</option>
                        </select>
                    </div>

                    <div class="cal-box">
                        <p>นำรายได้นี้ไปคำนวณกับ</p>

                        <div class="check-box">
                            <input type="checkbox" id="securitySocialFund">
                            <p>ประกันสังคม</p>
                        </div>
                        <div class="check-box">
                            <input type="checkbox" id="providentFund">
                            <p>กองทุนสำรองเลี้ยงชีพ</p>
                        </div>
                        <div class="check-box">
                            <input type="checkbox" id="overtime">
                            <p>ค่าล่วงเวลา</p>
                        </div>
                        <div class="check-box">
                            <input type="checkbox" id="lateMissing">
                            <p>หักสายขาดงาน</p>
                        </div>
                    </div>

                </div>
            </div>
            <br>
            <hr>
            <br>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 20px;">
                    <p>เปิดใช้งาน</p>
                    <label class="switch">
                        <input type="checkbox" id="statusToggle">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="cancel-btn" onclick="closedEditIncomeOverlay();">ยกเลิก</button>
                    <button class="save-btn" onclick="openConfirmModal();">บันทึก</button>
                </div>
            </div>
        </div>
    </div>

    <!--over edit deduction-->
    <div id="overlay-deduction" class="overlay-deduction" style="display: none;">
        <div class="overlay-deduction-content">
            <div class="head-overlay">
                <h3>แก้ไขรายได้ (เงินเดือนพนักงาน)</h3>
                <button class="x-btn" id="closeButton" onclick="closedEditDeductionOverlay()">X</button>
            </div>
            <hr>
            <div>
                <p>รหัส</p>
                <input type="text" id="du-code" class="code-box" disabled>

                <p>ชื่อรายได้</p>
                <input type="text" id="deduction-value" class="edit-input">

                <div class="pay-box">
                    <h3>เงื่อนไขการจ่าย</h3>
                    <div class="pay-select">
                        <p>รายได้นี้ทำจ่าย</p>
                        <select id="pay-deduction">
                            <option value="ทุกงวด">ทุกงวด</option>
                            <option value="งวดสิ้นเดือน">งวดสิ้นเดือน</option>
                        </select>
                    </div>
                </div>

                <div class="pay-box">
                    <h3>เงื่อนไขการคำนวณ</h3>
                    <div class="pay-select">
                        <p>นำไปคำนวนภาษี</p>
                        <select id="cal-tax-deduction">
                            <option value="ไม่คำนวณ">ไม่คำนวณ</option>
                            <option value="ทั้งปี">ทั้งปี</option>
                            <option value="ครั้งเดียว">ครั้งเดียว</option>
                        </select>
                    </div>

                    <div class="cal-box">
                        <p>นำรายได้นี้ไปคำนวณกับ</p>

                        <div class="check-box">
                            <input type="checkbox" id="security-social-fund-deduction">
                            <p>ประกันสังคม</p>
                        </div>
                        <div class="check-box">
                            <input type="checkbox" id="provident-fund-deduction">
                            <p>กองทุนสำรองเลี้ยงชีพ</p>
                        </div>
                    </div>

                </div>

            </div>
            <br>
            <hr>
            <br>

            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 20px;">
                    <p>เปิดใช้งาน</p>
                    <label class="switch">
                        <input type="checkbox" id="status-deduction">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="cancel-btn" onclick="closedEditDeductionOverlay();">ยกเลิก</button>
                    <button class="save-btn" onclick="openConfirmDeduction();">บันทึก</button>
                </div>
            </div>
        </div>
    </div>


    <div id="confirm-edit-income" class="modal-confirm-income">
        <div class="modal-content-income">
            <div style="display: flex; align-items: center; justify-content: space-evenly;">
                <img src="./symbol_hrm/question-confirm.jpg" style="width: 300px;">
                <div>
                    <p>กรุณาการยืนยันการดำเนินรายการ</p>
                    <p>คุณแน่ใจที่จะดำเนินรายการใช่หรือไม่</p>
                </div>
            </div>
            <div style="text-align: right;">
                <button class="cancel-btn" onclick="closeConfirmModal()">ยกเลิก</button>
                <button class="save-btn" onclick="sendUpdateIncome();">ยืนยัน</button>
            </div>
        </div>
    </div>

    <div id="confirm-edit-deduction" class="modal-confirm-deduction">
        <div class="add-content-deduction">
            <div style="display: flex; align-items: center; justify-content: space-evenly;">
                <img src="./symbol_hrm/question-confirm.jpg" style="width: 300px;">
                <div>
                    <p>กรุณาการยืนยันการดำเนินรายการ</p>
                    <p>คุณแน่ใจที่จะดำเนินรายการใช่หรือไม่</p>
                </div>
            </div>
            <div style="text-align: right;">
                <button class="cancel-btn" onclick="closeConfirmDeduction()">ยกเลิก</button>
                <button class="save-btn" onclick="sendUpdateDeduction();">ยืนยัน</button>
            </div>
        </div>
    </div>

    <div id="confirm-add-deduction" class="add-confirm-deduction">
        <div class="modal-content-deduction">
            <div style="display: flex; align-items: center; justify-content: space-evenly;">
                <img src="./symbol_hrm/question-confirm.jpg" style="width: 300px;">
                <div>
                    <p>กรุณาการยืนยันการดำเนินรายการ</p>
                    <p>คุณแน่ใจที่จะดำเนินรายการใช่หรือไม่</p>
                </div>
            </div>
            <div style="text-align: right;">
                <button class="cancel-btn" onclick="closedConfirmDeduction()">ยกเลิก</button>
                <button class="save-btn" onclick="sendAddDeduction();">ยืนยัน</button>
            </div>
        </div>
    </div>

    <script>
        let ENDPOINT = window.API_URL;
        const token = localStorage.getItem('token');

        function showData(content) {
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }
            var selectedContent = document.getElementById(content);
            if (selectedContent) {
                selectedContent.classList.add("active");
            }
        }
        showData('income')

        // data income
        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        var raw = JSON.stringify({
            "token": token
        });

        var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };

        fetch(ENDPOINT + "api/getData", requestOptions)
            .then(response => {
                return response.json()
            })
            .then(result => {
                let incomeHTML = '';
                const incomeTable = document.getElementById("incomeTbody");
                for (let i in result.income) {
                    // console.log(result.income[i]);
                    incomeHTML += `
                        <tr>
                            <td>${result.income[i].code}</td>
                            <td>${result.income[i].income}</td>
                            <td>${result.income[i].type}</td>
                            <td>${result.income[i].cal_tax}</td>
                            <td>${result.income[i].out_of_period !== null ? result.income[i].out_of_period : ''}</td>
                            <td>${result.income[i].next_period !== null ? result.income[i].next_period : ''}</td>
                            <td>${result.income[i].pay}</td>
                             <td>
                                <div class="icon">
                                    <p>${result.income[i].security_social_fund ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'}</p>
                                    <p>${result.income[i].provident_fund ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'} </p>
                                    <p>${result.income[i].overtime ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'} </p>
                                    <p>${result.income[i].late_missing ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'}</p>
                                </div>
                            </td>
                            <td>
                                <p>${result.income[i].welfare_benefit ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'}</p> 
                            </td>
                            <td>${result.income[i].status ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'}</td>
                            <td colspan="2">
                                <button class="edit-btn" onclick="openEditIncome('${result.income[i].code}')">
                                    EDIT
                                </button>
                            </td>
                        </tr>
                    `;
                }
                incomeTable.innerHTML += incomeHTML;

                const deductionTable = document.getElementById("deductionTBody");
                let deductionHTML = '';
                for (let i in result.deduction) {

                    deductionHTML += `
                        <tr>
                            <td>${result.deduction[i].du_code}</td>
                            <td>${result.deduction[i].deduction}</td>
                            <td>${result.deduction[i].du_cal_tax !== null ? result.deduction[i].du_cal_tax : 'ไม่คำนวน'}</td>
                            <td>${result.deduction[i].du_out_of_period !== null ? result.deduction[i].du_out_of_period : ''}</td>
                            <td>${result.deduction[i].du_next_period !== null ? result.deduction[i].du_next_period : ''}</td>
                            <td>${result.deduction[i].du_pay}</td>
                            <td>
                                <div class="icon">
                                    <p>${result.deduction[i].du_security_social_fund ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'}</p>
                                    <p>${result.deduction[i].du_provident_fund ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'} </p>
                                </div>
                            </td>
                             <td>
                                <p>${result.deduction[i].du_welfare_benefit ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'}</p> 
                            </td>
                            <td>${result.deduction[i].du_status ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'}</td>
                            <td colspan="2">
                                <button class="edit-btn" onclick="openEditDeduction('${result.deduction[i].du_code}')">
                                    EDIT
                                </button>
                            </td>
                        </tr>
                    `;
                }
                deductionTable.innerHTML += deductionHTML;

            })
            .catch(error => {
                console.log('error', error)
            });

        function openEditIncome(code) {

            document.getElementById('overlay-income').style.display = 'block';

            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            var raw = JSON.stringify({
                "token": token,
                "code": code
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            fetch(ENDPOINT + "api/getIncomeByCode", requestOptions)
                .then(response => {
                    return response.json()
                })
                .then(result => {
                    console.log(result)

                    let code = result.data[0].code;
                    document.getElementById('code').value = code;

                    let income = result.data[0].income;
                    document.getElementById('incomeValue').value = income;

                    let type = result.data[0].type;
                    document.getElementById('type').value = type;

                    let calTax = result.data[0].cal_tax;
                    document.getElementById('calTaxValue').value = calTax;

                    let pay = result.data[0].pay;
                    document.getElementById('pay').value = pay;

                    let securitySocialFund = result.data[0].security_social_fund;
                    let checkboxSocialFund = document.getElementById('securitySocialFund');
                    checkboxSocialFund.checked = securitySocialFund;

                    let providentFund = result.data[0].provident_fund;
                    let checkboxProvident = document.getElementById('providentFund');
                    checkboxProvident.checked = providentFund;

                    let overtime = result.data[0].overtime;
                    let checkboxOvertime = document.getElementById('overtime');
                    checkboxOvertime.checked = overtime;

                    let lateMissing = result.data[0].late_missing;
                    let checkboxLateMissing = document.getElementById('lateMissing');
                    checkboxLateMissing.checked = lateMissing;

                    let status = result.data[0].status;
                    let statusToggle = document.getElementById('statusToggle');
                    statusToggle.checked = status;

                })
                .catch(error => {
                    console.log('error', error)
                });
        }

        function closedEditIncomeOverlay() {
            document.getElementById('overlay-income').style.display = 'none';
        }

        function openEditDeduction(code) {

            document.getElementById('overlay-deduction').style.display = 'block';

            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            var raw = JSON.stringify({
                "token": token,
                "code": code
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            fetch(ENDPOINT + "api/getDeductionByCode", requestOptions)
                .then(response => {
                    return response.json()
                })
                .then(result => {
                    console.log(result)
                    let duCode = result.data[0].du_code;
                    document.getElementById('du-code').value = duCode;

                    let deduction = result.data[0].deduction;
                    document.getElementById('deduction-value').value = deduction;

                    let calTaxDeduction = result.data[0].du_cal_tax;
                    document.getElementById('cal-tax-deduction').value = calTaxDeduction;

                    let payDeduction = result.data[0].du_pay;
                    document.getElementById('pay-deduction').value = payDeduction;

                    let securitySocialFund = result.data[0].du_security_social_fund;
                    let checkboxSocialFund = document.getElementById('security-social-fund-deduction');
                    checkboxSocialFund.checked = securitySocialFund;

                    let providentFund = result.data[0].du_provident_fund;
                    let checkboxProvident = document.getElementById('provident-fund-deduction');
                    checkboxProvident.checked = providentFund;
                    console.log('providentFund', providentFund);

                    let status = result.data[0].du_status;
                    let statusToggle = document.getElementById('status-deduction');
                    statusToggle.checked = status;
                })
                .catch(error => {
                    console.log('error', error)
                });
        }

        function closedEditDeductionOverlay() {
            document.getElementById('overlay-deduction').style.display = 'none';
        }

        function addIncomeOverlay() {
            document.getElementById('overlay-add-income').style.display = 'block';
        }

        function closedAddIncomeOverlay() {
            document.getElementById('overlay-add-income').style.display = 'none';
        }

        function addDeductionOverlay() {
            document.getElementById('overlay-add-deduction').style.display = 'block';
        }

        function closedAddDeductionOverlay() {
            document.getElementById('overlay-add-deduction').style.display = 'none';
        }

        function openConfirmModal() {
            var modal = document.getElementById("confirm-edit-income");
            modal.style.display = "block";
        }

        function closeConfirmModal() {
            var modal = document.getElementById("confirm-edit-income");
            modal.style.display = "none";
        }

        function openConfirmDeduction() {
            var modal = document.getElementById("confirm-edit-deduction");
            modal.style.display = "block";
        }

        function closeConfirmDeduction() {
            var modal = document.getElementById("confirm-edit-deduction");
            modal.style.display = "none";
        }

        function openConfirmDeduction() {
            var modal = document.getElementById("confirm-add-deduction");
            modal.style.display = "block";
        }

        function closedConfirmDeduction() {
            var modal = document.getElementById("confirm-add-deduction");
            modal.style.display = "none";
        }


        function sendUpdateIncome() {
            var code = document.getElementById('code').value;
            var income = document.getElementById('incomeValue').value;
            var type = document.getElementById('type').value;
            var calTax = document.getElementById('calTaxValue').value;
            var pay = document.getElementById('pay').value;

            var securitySocialFund = document.getElementById('securitySocialFund').checked;
            var providentFund = document.getElementById('providentFund').checked;
            var overtime = document.getElementById('overtime').checked;
            var lateMissing = document.getElementById('lateMissing').checked;
            var status = document.getElementById('statusToggle').checked;

            console.log(code, income, type, calTax, pay);
            console.log(securitySocialFund, providentFund, overtime, lateMissing);
            console.log('statusToggle', status);
        }

        function sendUpdateDeduction() {
            var duCode = document.getElementById('du-code').value;
            var deduction = document.getElementById('deduction-value').value;
            var calTaxDeduction = document.getElementById('cal-tax-deduction').value;
            var payDeduction = document.getElementById('pay-deduction').value;
            var securitySocialFundDeduction = document.getElementById('security-social-fund-deduction').checked;
            var providentFundDeduction = document.getElementById('provident-fund-deduction').checked;
            var statusDeduction = document.getElementById('status-deduction').checked;


            console.log(duCode, deduction, calTaxDeduction, payDeduction, securitySocialFundDeduction, providentFundDeduction, statusDeduction);
        }

        function sendAddIncome() {
            var code = document.getElementById('add-code').value;
            var income = document.getElementById('add-income').value;
            var type = document.getElementById('add-type').value;
            var calTax = document.getElementById('add-cal-tax').value;
            var pay = document.getElementById('add-pay').value;

            var securitySocialFund = document.getElementById('add-security').checked;
            var providentFund = document.getElementById('add-provident').checked;
            var overtime = document.getElementById('add-overtime').checked;
            var lateMissing = document.getElementById('add-late').checked;
            var status = document.getElementById('add-status').checked;

            console.log(code, income, type, calTax, pay);
            console.log(securitySocialFund, providentFund, overtime, lateMissing);
            console.log('status', status);
        }

        function sendAddDeduction() {
            var code = document.getElementById('add-deduction-code').value;
            var deduction = document.getElementById('add-deduction-name').value;
            var type = document.getElementById('add-deduction-pay').value;
            var calTax = document.getElementById('add-cal-tax-deduction').value;
            var securitySocialFund = document.getElementById('add-security-deduction').checked;
            var providentFund = document.getElementById('add-provident-deduction').checked;
            var status = document.getElementById('add-status-deduction').checked;

            console.log(code, deduction, type, calTax, securitySocialFund, providentFund, status);
        }
    </script>
</body>

</html>